#the ai Model
from re import split
from cs50 import SQL
import os
from replit import db
import sounddevice as sd
from scipy.io.wavfile import write
import time
import wavio as wv
import random
from replit.audio import InvalidFileType
import speech_recognition as sr

sr.__version__
def recognize_speech():
  audioo = ('')
  attempts = 0
  while audioo == ('') and attempts < 3:
    attempts = 0
    Recognise = sr.Recognizer()
    aud_file = input('Please enter your file: ')
    with sr.AudioFile(aud_file) as source:
      print("Recognising..")
      aud = Recognise.record(source, duration=10)
      Recognise.adjust_for_ambient_noise(source)
    try:
      audioo = Recognise.recognize_google(aud)
      print("You said:", audioo)
      if audioo == '':
        print('There is no input detected')
      else:
        print('There is an input')
      if attempts < 2:
        print('Please try again')
      return (audioo)
    except sr.UnknownValueError:
      print("Sorry, could not understand audio and Please Try Again.")
    except sr.RequestError as e:
      print(f"Error with the recognition service; {e}")
    attempts += 1
    print(attempts)
print(os.getenv("REPLIT_DB_URL"))

if __name__ == "__main__":
  recognize_speech()
db = SQL("sqlite:///database.db")

# database creation
def database_creation():
  db.execute(
      "CREATE TABLE IF NOT EXISTS Mai ( Name TEXT, Year_grp     INTEGER,Form TEXT,Voice_sample TEXT,Word TEXT,Signed_in       TEXT)"
  )
  db.execute(
      "INSERT OR REPLACE INTO Mai  (             Name,Year_grp,Form,Voice_sample,Word,Signed_in) VALUES(?,     ?,?,?,?,?)",
      'Akarsh', 13, '13R', 'Yes', 'gold', 'No')
  db.execute(
      "INSERT OR REPLACE INTO Mai  (                     Name,Year_grp,Form,Voice_sample,Word,Signed_in) VALUES(?,     ?,?,?,?,?)",
      'Sachin', 11, '10K', 'Yes', '', 'No')
  db.execute(
      "INSERT OR REPLACE INTO Mai (   Name,Year_grp,Form,Voice_sample,Word,Signed_in) VALUES(?,      ?,?,?,?,?)",
      'Haran', 9, '9K', 'Yes', '', 'No')


School_data = db.execute("SELECT DISTINCT Word FROM Mai")
    
No_data = len(School_data)

# function in order to isolate the singular words
for i in range(0, No_data):
  Keyword = str(School_data[i])
  Keyword_split = Keyword.split()
  Single_word = Keyword_split[1]
  Only_word = "".join(c for c in Single_word if c.isalpha())
  # Function from builtin.com to remove all the non letters in a code
  Name_data = db.execute('SELECT DISTINCT Name FROM Mai')
  Key_Name = str(Name_data[i])
  Name_split = Key_Name.split()
  Name_single = Name_split[1]
  Name_final = "".join(c for c in Name_single if c.isalpha())
  # compares the input word(recognise speech) and the word in the database
  if Only_word == recognize_speech():
    db.execute("UPDATE Mai SET Signed_in='Yes' WHERE Name= ?", (Name_final))
    print(Name_final, 'has signed in')
    break
  else:
    print('No you have been unable to be signed in')
Empty_word = db.execute(
    'SELECT Name FROM Mai WHERE ifnull(length(Word), 0) = 0 ')
print(Empty_word)
import string
import random
word_temp = ['']
Word_final = ['']
# This would take in the comparison of the amount of words available to choose from
with open('common-wordss.txt') as word_file:
  english_words = set(word.strip().lower() for word in word_file)

  def is_english_word(word):
    return word.lower() in english_words


# this is a function to compare the word generated by the random string concatanation and would compare it in the function and check if it is a real dictionary word.
while is_english_word(word_temp[0]) == False and Empty_word != '':
  if is_english_word(word_temp[0]) == False:
    # resets the array to no strings inside it.
    word_temp.clear()
  string.ascii_letters
  # iterates through the code 5 times and add 5 different letters through the random function and the string lowercase function.
  for i in range(0, 5):
    Word = word_temp.append(random.choice(string.ascii_lowercase))
    # joins the 5 seperate strings
  word_temp[0:5] = [''.join(word_temp[0:5])]
  Final_studs = ['']

